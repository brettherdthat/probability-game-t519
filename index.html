<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dice Probability Game - Learn Through Play!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        #webcam {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 200px;
            height: 150px;
            object-fit: cover;
            transform: scaleX(-1);
            border: 3px solid white;
            border-radius: 10px;
            z-index: 5;
            opacity: 0.8;
        }

        #handCanvas {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 200px;
            height: 150px;
            z-index: 6;
            pointer-events: none;
        }

        #gameBoard {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 2;
        }

        .column {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(255, 255, 255, 0.15);
            border: 3px solid rgba(255, 255, 255, 0.4);
            border-radius: 12px;
            padding: 15px 8px;
            min-width: 70px;
            backdrop-filter: blur(10px);
        }

        .column-number {
            font-size: 28px;
            font-weight: bold;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 10px;
        }

        .chips-container {
            display: flex;
            flex-direction: column-reverse;
            gap: 3px;
            min-height: 120px;
            align-items: center;
        }

        .chip {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border: 3px solid #FF8C00;
            border-radius: 50%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            animation: chipPop 0.3s ease-out;
        }

        @keyframes chipPop {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        #diceArea {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 40px;
            z-index: 3;
        }

        .die {
            width: 100px;
            height: 100px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 60px;
            font-weight: bold;
            color: #333;
            position: relative;
        }

        .die.rolling {
            animation: rollDice 0.6s ease-in-out;
        }

        @keyframes rollDice {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(90deg) scale(1.1); }
            50% { transform: rotate(180deg) scale(0.9); }
            75% { transform: rotate(270deg) scale(1.1); }
        }

        #sumDisplay {
            position: absolute;
            top: 180px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 48px;
            font-weight: bold;
            color: white;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            padding: 15px 40px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            z-index: 3;
        }

        #rollCounter {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px 30px;
            border-radius: 15px;
            border: 3px solid white;
            z-index: 4;
        }

        #rollCounter .label {
            color: white;
            font-size: 18px;
            margin-bottom: 5px;
        }

        #rollCounter .count {
            color: #FFD700;
            font-size: 42px;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }

        #instructions {
            position: absolute;
            top: 10px;
            left: 180px;
            background: rgba(255, 255, 255, 0.9);
            padding: 12px 15px;
            border-radius: 10px;
            max-width: 220px;
            z-index: 4;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        #instructions h3 {
            color: #667eea;
            margin-bottom: 6px;
            font-size: 16px;
        }

        #instructions p {
            color: #333;
            font-size: 13px;
            line-height: 1.3;
            margin-bottom: 4px;
        }

        #instructions .gesture-hint {
            background: #667eea;
            color: white;
            padding: 6px 8px;
            border-radius: 6px;
            text-align: center;
            font-weight: bold;
            margin-top: 6px;
            font-size: 12px;
        }

        .die-label {
            position: absolute;
            top: -40px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .die.ready {
            background: #4ade80;
            box-shadow: 0 0 20px rgba(74, 222, 128, 0.6);
        }

        .die.waiting {
            background: #fbbf24;
        }

        #startScreen, #roundTransition, #victoryScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            padding: 40px;
        }

        #startScreen h1 {
            font-size: 64px;
            color: #FFD700;
            text-shadow: 0 0 30px rgba(255, 215, 0, 1);
            margin-bottom: 30px;
            animation: pulse 2s infinite;
        }

        #startScreen p, #roundTransition p {
            font-size: 24px;
            color: white;
            margin: 15px 0;
            text-align: center;
            max-width: 900px;
            line-height: 1.6;
        }

        #startScreen .highlight {
            color: #4ade80;
            font-size: 28px;
            font-weight: bold;
        }

        button {
            margin-top: 30px;
            padding: 20px 60px;
            font-size: 32px;
            background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            transition: transform 0.2s;
        }

        button:hover {
            transform: scale(1.05);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .hidden {
            display: none !important;
        }

        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 28px;
            z-index: 11;
        }

        .remove-animation {
            animation: chipRemove 0.5s ease-out forwards;
        }

        @keyframes chipRemove {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(2) translateY(-50px); opacity: 0; }
        }

        #roundInfo {
            position: absolute;
            top: 20px;
            right: 230px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 25px;
            border-radius: 15px;
            border: 3px solid white;
            color: white;
            font-size: 24px;
            font-weight: bold;
            z-index: 4;
        }

        #redistributionUI {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.98);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            z-index: 15;
            max-width: 1100px;
            max-height: 90vh;
            overflow-y: auto;
        }

        #redistributionUI h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 36px;
            text-align: center;
        }

        #redistributionUI .instructions {
            color: #333;
            font-size: 18px;
            margin-bottom: 20px;
            text-align: center;
        }

        #redistributionGrid {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .redist-column {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            background: rgba(102, 126, 234, 0.1);
            border: 2px solid #667eea;
            border-radius: 12px;
            min-width: 80px;
        }

        .redist-column .number {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .redist-column .chip-count {
            font-size: 48px;
            font-weight: bold;
            color: #333;
            margin: 10px 0;
        }

        .redist-column .buttons {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }

        .redist-column button {
            padding: 8px 16px;
            font-size: 24px;
            margin: 0;
            border-radius: 8px;
            min-width: 45px;
        }

        #chipsRemaining {
            text-align: center;
            font-size: 24px;
            margin: 20px 0;
            color: #333;
            font-weight: bold;
        }

        #chipsRemaining.warning {
            color: #ff6b6b;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <!-- Start Screen -->
        <div id="startScreen">
            <h1>ðŸŽ² Dice Probability Game ðŸŽ²</h1>
            <p>Welcome! You're going to learn about probability by playing with dice!</p>
            <p class="highlight">The Challenge:</p>
            <p>You have a board with columns numbered 2-12. Each column has 3 chips.</p>
            <p>Roll two dice to get a sum, then remove a chip from that column!</p>
            <p>Your goal: Remove ALL chips in as few rolls as possible!</p>
            <p style="margin-top: 30px; font-size: 20px;">ðŸŽ² Throw your hands like rolling dice - Left hand = left die, Right hand = right die!</p>
            <button id="startButton">START GAME!</button>
        </div>

        <!-- Round Transition Screen -->
        <div id="roundTransition" class="hidden">
            <h1 id="transitionTitle">Round 1 Complete!</h1>
            <p id="transitionText"></p>
            <p style="color: #4ade80; font-size: 28px; margin-top: 30px;">Now it's your turn to be strategic!</p>
            <p>You can redistribute the 33 chips however you want across columns 2-12.</p>
            <p>Think about which numbers appeared most often...</p>
            <button id="redistributeButton">REDISTRIBUTE CHIPS</button>
        </div>

        <!-- Victory Screen -->
        <div id="victoryScreen" class="hidden">
            <h1>ðŸŽ‰ Congratulations! ðŸŽ‰</h1>
            <div id="victoryStats"></div>
            <p style="color: #4ade80; font-size: 24px; margin-top: 30px;">What did you learn?</p>
            <p>Some numbers appear more often because there are more ways to make them!</p>
            <p>For example: 7 can be made 6 different ways (1+6, 2+5, 3+4, 4+3, 5+2, 6+1)</p>
            <p>But 2 can only be made one way (1+1), and 12 can only be made one way (6+6)</p>
            <button id="playAgainButton">PLAY AGAIN</button>
        </div>

        <!-- Redistribution UI -->
        <div id="redistributionUI" class="hidden">
            <h2>Redistribute Your Chips!</h2>
            <p class="instructions">Place all 33 chips across columns 2-12. Think strategically!</p>
            <div id="chipsRemaining">Chips remaining: <span id="remainingCount">33</span></div>
            <div id="redistributionGrid"></div>
            <button id="startRound2Button" disabled>START ROUND 2</button>
        </div>

        <!-- Webcam Feed -->
        <video id="webcam" autoplay playsinline></video>

        <!-- Hand Detection Canvas -->
        <canvas id="handCanvas"></canvas>

        <!-- Game Board -->
        <div id="gameBoard" class="hidden"></div>

        <!-- Dice Area -->
        <div id="diceArea" class="hidden">
            <div style="position: relative;">
                <div class="die-label">Left Hand ðŸ‘ˆ</div>
                <div class="die" id="die1">?</div>
            </div>
            <div style="position: relative;">
                <div class="die-label">Right Hand ðŸ‘‰</div>
                <div class="die" id="die2">?</div>
            </div>
        </div>

        <!-- Sum Display -->
        <div id="sumDisplay" class="hidden">Sum: <span id="sumValue">0</span></div>

        <!-- Roll Counter -->
        <div id="rollCounter" class="hidden">
            <div class="label">Rolls</div>
            <div class="count" id="rollCount">0</div>
        </div>

        <!-- Round Info -->
        <div id="roundInfo" class="hidden">Round <span id="currentRound">1</span></div>

        <!-- Instructions -->
        <div id="instructions" class="hidden">
            <h3>How to Play:</h3>
            <p>ðŸŽ² Throw your left hand to roll left die</p>
            <p>ðŸŽ² Throw your right hand to roll right die</p>
            <p>âœ¨ Both dice remove chip automatically</p>
            <p>ðŸŽ¯ Clear all chips to win!</p>
            <div class="gesture-hint">THROW BOTH HANDS!</div>
        </div>

        <!-- Loading Message -->
        <div id="loading" class="hidden">Loading camera...</div>
    </div>

    <!-- MediaPipe Hands -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>

    <script>
        // Game State
        const gameState = {
            round: 1,
            rollCount: 0,
            round1Rolls: 0,
            round2Rolls: 0,
            chips: {},
            gameStarted: false,
            die1Value: null,
            die2Value: null,
            die1Rolled: false,
            die2Rolled: false,
            currentSum: 0,
            handTracking: {
                left: { prevY: 0, throwDetected: false, lastThrowTime: 0 },
                right: { prevY: 0, throwDetected: false, lastThrowTime: 0 }
            }
        };

        // Initialize chips for Round 1 (3 chips per column)
        function initializeRound1Chips() {
            gameState.chips = {};
            for (let i = 2; i <= 12; i++) {
                gameState.chips[i] = 3;
            }
        }

        // Detect throwing gesture (rapid downward movement)
        function detectThrow(hand, landmarks) {
            const wrist = landmarks[0];
            const currentY = wrist.y;
            const prevY = gameState.handTracking[hand].prevY;

            // Calculate downward velocity
            const velocity = currentY - prevY;

            // Throwing detected: rapid downward movement
            const isThrow = velocity > 0.08; // Threshold for throw detection

            gameState.handTracking[hand].prevY = currentY;

            return isThrow;
        }

        // Reset dice state for next round
        function resetDiceState() {
            gameState.die1Value = null;
            gameState.die2Value = null;
            gameState.die1Rolled = false;
            gameState.die2Rolled = false;
            updateDiceDisplay();
        }

        // Initialize Camera and Hand Tracking
        async function initCamera() {
            const video = document.getElementById('webcam');
            const handCanvas = document.getElementById('handCanvas');
            const handCtx = handCanvas.getContext('2d');

            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { width: 640, height: 480 }
                });
                video.srcObject = stream;

                const hands = new Hands({
                    locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
                });

                hands.setOptions({
                    maxNumHands: 2, // Track both hands
                    modelComplexity: 1,
                    minDetectionConfidence: 0.6,
                    minTrackingConfidence: 0.6
                });

                hands.onResults((results) => {
                    handCtx.clearRect(0, 0, handCanvas.width, handCanvas.height);

                    if (results.multiHandLandmarks && results.multiHandedness && gameState.gameStarted) {
                        for (let i = 0; i < results.multiHandLandmarks.length; i++) {
                            const landmarks = results.multiHandLandmarks[i];
                            const handedness = results.multiHandedness[i].label; // "Left" or "Right"

                            // MediaPipe returns mirrored labels, so flip them
                            const hand = handedness === 'Left' ? 'right' : 'left';

                            // Draw hand indicator
                            const wrist = landmarks[0];
                            const x = (1 - wrist.x) * handCanvas.width;
                            const y = wrist.y * handCanvas.height;

                            // Check if hand is throwing
                            const isThrow = detectThrow(hand, landmarks);
                            const now = Date.now();

                            if (isThrow && now - gameState.handTracking[hand].lastThrowTime > 800) {
                                gameState.handTracking[hand].lastThrowTime = now;

                                // Roll the corresponding die
                                if (hand === 'left' && !gameState.die1Rolled) {
                                    rollDie(1);
                                } else if (hand === 'right' && !gameState.die2Rolled) {
                                    rollDie(2);
                                }
                            }

                            // Draw hand visualization
                            const dieRolled = hand === 'left' ? gameState.die1Rolled : gameState.die2Rolled;
                            handCtx.fillStyle = dieRolled ? 'rgba(74, 222, 128, 0.7)' : 'rgba(255, 215, 0, 0.6)';
                            handCtx.beginPath();
                            handCtx.arc(x, y, 30, 0, Math.PI * 2);
                            handCtx.fill();

                            // Label
                            handCtx.fillStyle = 'white';
                            handCtx.font = 'bold 16px Arial';
                            handCtx.fillText(hand === 'left' ? 'L' : 'R', x - 6, y + 6);
                        }
                    }
                });

                const camera = new Camera(video, {
                    onFrame: async () => await hands.send({ image: video }),
                    width: 640,
                    height: 480
                });

                camera.start();
                document.getElementById('loading').classList.add('hidden');
            } catch (err) {
                alert('Camera access required to play! Please allow camera access.');
                console.error(err);
            }
        }

        // Roll individual die
        function rollDie(dieNumber) {
            const die = document.getElementById(`die${dieNumber}`);
            die.classList.add('rolling');

            // Random value
            const value = Math.floor(Math.random() * 6) + 1;

            setTimeout(() => {
                if (dieNumber === 1) {
                    gameState.die1Value = value;
                    gameState.die1Rolled = true;
                } else {
                    gameState.die2Value = value;
                    gameState.die2Rolled = true;
                }

                die.textContent = getDiceFace(value);
                die.classList.remove('rolling');
                die.classList.add('ready');

                updateDiceDisplay();

                // Check if both dice are rolled
                if (gameState.die1Rolled && gameState.die2Rolled) {
                    setTimeout(() => {
                        processRoll();
                    }, 300);
                }
            }, 400);
        }

        // Update dice display
        function updateDiceDisplay() {
            const die1 = document.getElementById('die1');
            const die2 = document.getElementById('die2');

            // Update die colors based on state
            if (gameState.die1Rolled) {
                die1.classList.add('ready');
            } else {
                die1.classList.remove('ready');
                die1.classList.add('waiting');
            }

            if (gameState.die2Rolled) {
                die2.classList.add('ready');
            } else {
                die2.classList.remove('ready');
                die2.classList.add('waiting');
            }

            // Update sum display
            if (gameState.die1Rolled && gameState.die2Rolled) {
                const sum = gameState.die1Value + gameState.die2Value;
                document.getElementById('sumValue').textContent = sum;
            } else {
                document.getElementById('sumValue').textContent = '?';
            }
        }

        // Process roll when both dice are ready
        function processRoll() {
            const sum = gameState.die1Value + gameState.die2Value;
            gameState.currentSum = sum;

            gameState.rollCount++;
            if (gameState.round === 1) {
                gameState.round1Rolls++;
            } else {
                gameState.round2Rolls++;
            }
            updateRollCounter();

            // Remove chip if available
            if (gameState.chips[sum] > 0) {
                removeChip(sum);
            }

            // Check if round complete
            if (isRoundComplete()) {
                endRound();
            } else {
                // Reset for next roll
                setTimeout(() => {
                    resetDiceState();
                }, 800);
            }
        }

        // Get dice face emoji
        function getDiceFace(value) {
            const faces = ['', 'âš€', 'âš', 'âš‚', 'âšƒ', 'âš„', 'âš…'];
            return faces[value];
        }

        // Remove chip from column
        function removeChip(column) {
            if (gameState.chips[column] > 0) {
                gameState.chips[column]--;
                renderBoard();
            }
        }

        // Check if round is complete
        function isRoundComplete() {
            return Object.values(gameState.chips).every(count => count === 0);
        }

        // End current round
        function endRound() {
            gameState.gameStarted = false;

            if (gameState.round === 1) {
                // Show transition screen
                document.getElementById('transitionText').textContent =
                    `You completed Round 1 in ${gameState.round1Rolls} rolls! Some numbers probably appeared more than others...`;
                document.getElementById('roundTransition').classList.remove('hidden');
            } else {
                // Show victory screen
                showVictoryScreen();
            }
        }

        // Show victory screen
        function showVictoryScreen() {
            const improvement = gameState.round1Rolls - gameState.round2Rolls;
            const percentage = ((improvement / gameState.round1Rolls) * 100).toFixed(1);

            let message = '';
            if (improvement > 0) {
                message = `You improved by ${improvement} rolls (${percentage}% better)! ðŸŽ‰`;
            } else if (improvement < 0) {
                message = `Round 1 was better by ${Math.abs(improvement)} rolls. Try redistributing differently!`;
            } else {
                message = `Both rounds took the same number of rolls!`;
            }

            document.getElementById('victoryStats').innerHTML = `
                <p style="font-size: 32px; color: white; margin: 20px 0;">
                    Round 1: ${gameState.round1Rolls} rolls (even distribution)
                </p>
                <p style="font-size: 32px; color: white; margin: 20px 0;">
                    Round 2: ${gameState.round2Rolls} rolls (your strategy)
                </p>
                <p style="font-size: 36px; color: #4ade80; margin: 30px 0;">
                    ${message}
                </p>
            `;

            document.getElementById('victoryScreen').classList.remove('hidden');
        }

        // Render game board
        function renderBoard() {
            const board = document.getElementById('gameBoard');
            board.innerHTML = '';

            for (let i = 2; i <= 12; i++) {
                const column = document.createElement('div');
                column.className = 'column';

                const number = document.createElement('div');
                number.className = 'column-number';
                number.textContent = i;

                const chipsContainer = document.createElement('div');
                chipsContainer.className = 'chips-container';

                for (let j = 0; j < gameState.chips[i]; j++) {
                    const chip = document.createElement('div');
                    chip.className = 'chip';
                    chipsContainer.appendChild(chip);
                }

                column.appendChild(number);
                column.appendChild(chipsContainer);
                board.appendChild(column);
            }
        }

        // Update roll counter
        function updateRollCounter() {
            document.getElementById('rollCount').textContent = gameState.rollCount;
        }

        // Start Round 1
        function startRound1() {
            gameState.round = 1;
            gameState.rollCount = 0;
            gameState.round1Rolls = 0;
            initializeRound1Chips();
            startGameplay();
        }

        // Start gameplay (common for both rounds)
        function startGameplay() {
            gameState.gameStarted = true;
            resetDiceState();

            document.getElementById('currentRound').textContent = gameState.round;
            document.getElementById('gameBoard').classList.remove('hidden');
            document.getElementById('diceArea').classList.remove('hidden');
            document.getElementById('sumDisplay').classList.remove('hidden');
            document.getElementById('rollCounter').classList.remove('hidden');
            document.getElementById('roundInfo').classList.remove('hidden');
            document.getElementById('instructions').classList.remove('hidden');

            renderBoard();
            updateRollCounter();
        }

        // Show redistribution UI
        function showRedistributionUI() {
            document.getElementById('roundTransition').classList.add('hidden');
            document.getElementById('redistributionUI').classList.remove('hidden');

            const grid = document.getElementById('redistributionGrid');
            grid.innerHTML = '';

            // Reset chips to 0
            for (let i = 2; i <= 12; i++) {
                gameState.chips[i] = 0;
            }

            // Create redistribution columns
            for (let i = 2; i <= 12; i++) {
                const column = document.createElement('div');
                column.className = 'redist-column';

                const number = document.createElement('div');
                number.className = 'number';
                number.textContent = i;

                const chipCount = document.createElement('div');
                chipCount.className = 'chip-count';
                chipCount.id = `redist-${i}`;
                chipCount.textContent = '0';

                const buttons = document.createElement('div');
                buttons.className = 'buttons';

                const plusBtn = document.createElement('button');
                plusBtn.textContent = '+';
                plusBtn.onclick = () => addChip(i);

                const minusBtn = document.createElement('button');
                minusBtn.textContent = '-';
                minusBtn.onclick = () => removeRedistChip(i);

                buttons.appendChild(minusBtn);
                buttons.appendChild(plusBtn);

                column.appendChild(number);
                column.appendChild(chipCount);
                column.appendChild(buttons);
                grid.appendChild(column);
            }

            updateRemainingChips();
        }

        // Add chip during redistribution
        function addChip(column) {
            const totalChips = Object.values(gameState.chips).reduce((a, b) => a + b, 0);
            if (totalChips < 33) {
                gameState.chips[column]++;
                document.getElementById(`redist-${column}`).textContent = gameState.chips[column];
                updateRemainingChips();
            }
        }

        // Remove chip during redistribution
        function removeRedistChip(column) {
            if (gameState.chips[column] > 0) {
                gameState.chips[column]--;
                document.getElementById(`redist-${column}`).textContent = gameState.chips[column];
                updateRemainingChips();
            }
        }

        // Update remaining chips counter
        function updateRemainingChips() {
            const totalChips = Object.values(gameState.chips).reduce((a, b) => a + b, 0);
            const remaining = 33 - totalChips;

            document.getElementById('remainingCount').textContent = remaining;

            const chipsRemainingDiv = document.getElementById('chipsRemaining');
            if (remaining === 0) {
                chipsRemainingDiv.classList.remove('warning');
                chipsRemainingDiv.classList.add('success');
                document.getElementById('startRound2Button').disabled = false;
            } else {
                chipsRemainingDiv.classList.add('warning');
                document.getElementById('startRound2Button').disabled = true;
            }
        }

        // Start Round 2
        function startRound2() {
            gameState.round = 2;
            gameState.rollCount = 0;
            gameState.round2Rolls = 0;

            document.getElementById('redistributionUI').classList.add('hidden');
            startGameplay();
        }

        // Event Listeners
        document.getElementById('startButton').addEventListener('click', async () => {
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('loading').classList.remove('hidden');
            await initCamera();
            startRound1();
        });

        document.getElementById('redistributeButton').addEventListener('click', () => {
            showRedistributionUI();
        });

        document.getElementById('startRound2Button').addEventListener('click', () => {
            startRound2();
        });

        document.getElementById('playAgainButton').addEventListener('click', () => {
            document.getElementById('victoryScreen').classList.add('hidden');
            document.getElementById('gameBoard').classList.add('hidden');
            document.getElementById('diceArea').classList.add('hidden');
            document.getElementById('sumDisplay').classList.add('hidden');
            document.getElementById('rollCounter').classList.add('hidden');
            document.getElementById('roundInfo').classList.add('hidden');
            document.getElementById('instructions').classList.add('hidden');
            startRound1();
        });
    </script>
</body>
</html>
